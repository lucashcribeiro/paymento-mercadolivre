var DBTecheCommerce=window.DBTecheCommerce||{};
!function(c,f,g,h){DBTecheCommerce.ProductPricingManager=XF.Element.newHandler({options:{insertButton:".js-addProductPricing",manageUrl:null,productType:null,pricingContainer:".js-productCosts",costRow:".js-productCost",actionButton:".js-pricingAction",pricingTemplate:".js-pricingTemplate"},$pricingContainer:null,template:null,manageUrl:null,productType:null,init:function(){var a=this.options,b=this.$target;if(this.options.manageUrl)this.manageUrl=this.options.manageUrl;else if(b.attr("href"))this.manageUrl=
b.attr("href");else{console.error("No manage URL specified.");return}if(this.options.productType)this.productType=this.options.productType;else if(b.data("product-type"))this.productType=b.data("product-type");else{console.error("No product type specified.");return}this.$pricingContainer=b.find(a.pricingContainer);this.$pricingContainer.on("click",a.actionButton,c.proxy(this,"actionButtonClick"));b.on("click",a.insertButton,c.proxy(this,"insertButtonClick"));(this.template=b.find(a.pricingTemplate).html())||
console.error("No attached file template found.")},insertCostRow:function(a,b){a=this.applyCostTemplate(a);b?b.replaceWith(a):(this.$pricingContainer.addClass("is-active"),a.appendTo(this.$pricingContainer));XF.activate(a);XF.layoutChange();b=c.Event("cost:row-inserted");a.trigger(b,[a,this])},insertButtonClick:function(a){a.preventDefault();var b=this;XF.ajax("post",this.manageUrl,{product_type:this.productType},function(a){a.cost&&b.insertCostRow(a.cost)},{skipDefaultSuccess:!0})},actionButtonClick:function(a){a.preventDefault();
var b=c(a.currentTarget);a=b.attr("data-action");b=b.closest(this.options.costRow);switch(a){case "delete":this.deleteProductCost(b)}},deleteProductCost:function(a){var b=a.data("cost-id");if(b){var c=this;XF.ajax("post",this.manageUrl,{delete:b},function(b){b.delete&&c.removeCostRow(a)},{skipDefaultSuccess:!0})}},applyCostTemplate:function(a){a=c(c.parseHTML(Mustache.render(this.template,a)));var b=this.options.costRow;return a.filter(function(){return c(this).is(b)})},removeCostRow:function(a){a.remove();
this.$pricingContainer.find(this.options.costRow).length||(this.$pricingContainer.removeClass("is-active"),XF.layoutChange())}});DBTecheCommerce.ProductPricingOnInsert=XF.Element.newHandler({options:{costRow:".js-productCost",href:null,linkData:null},loading:!1,init:function(){var a=this.$target.closest(this.options.costRow);a.length&&this.options.href||console.error("Cannot find inserted row or action to perform.");a.on("cost:row-inserted",c.proxy(this,"onCostInsert"))},onCostInsert:function(a,b,
k){if(!this.loading){var d=this;XF.ajax("post",this.options.href,this.options.linkData||{},c.proxy(this,"onLoad")).always(function(){d.loading=!1})}},onLoad:function(a){if(a.html){var b=this;XF.setupHtmlInsert(a.html,function(a,c,e){b.$target.replaceWith(a).xfFadeDown(XF.config.speed.xfast,function(){e(!0);XF.layoutChange()})})}}});XF.Element.register("dbtech-ecommerce-product-pricing-manager","DBTecheCommerce.ProductPricingManager");XF.Element.register("dbtech-ecommerce-product-pricing-on-insert",
"DBTecheCommerce.ProductPricingOnInsert")}(jQuery,window,document);
